<!DOCTYPE html>
<html class="dark" lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Giydir - AI Virtual Try-On</title>
    <base href="/" />
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13c8ec",
                        "background-light": "#f6f8f8",
                        "background-dark": "#05090a",
                        "panel-dark": "#0c1416",
                        "surface-dark": "#121d20",
                        "border-dark": "#203439",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px" },
                },
            },
        }
    </script>
    <link rel="stylesheet" href="css/site.css" />
    <!-- Image Comparison Slider -->
    <link rel="stylesheet" href="https://unpkg.com/img-comparison-slider@8/dist/styles.css">
    <script type="module" src="https://unpkg.com/img-comparison-slider@8/dist/index.js"></script>
    <HeadOutlet @rendermode="InteractiveServer" />
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-100 antialiased selection:bg-primary selection:text-white">
    <Routes @rendermode="InteractiveServer" />
    <script src="_framework/blazor.web.js"></script>
    <script>
        // Token yönetimi için JavaScript fonksiyonları
        window.tokenStorage = {
            setToken: function(token) {
                localStorage.setItem('jwtToken', token);
                // Cookie'yi de tarayıcıdan set et (Blazor Server SSR için kritik)
                document.cookie = "JwtToken=" + encodeURIComponent(token) + "; path=/; max-age=" + (10 * 24 * 60 * 60) + "; path=/; SameSite=Lax; Secure";
                console.log('[JS] Token localStorage ve cookie\'ye kaydedildi (Secure)');
            },
            getToken: function() {
                return localStorage.getItem('jwtToken') || '';
            },
            removeToken: function() {
                localStorage.removeItem('jwtToken');
                // Cookie'yi de temizle
                document.cookie = "JwtToken=; path=/; max-age=0; SameSite=Lax; Secure";
                console.log('[JS] Token localStorage ve cookie\'den silindi');
            },
            logout: function() {
                // localStorage ve cookie'yi temizle
                localStorage.removeItem('jwtToken');
                document.cookie = "JwtToken=; path=/; max-age=0; SameSite=Lax; Secure";
                console.log('[JS] Logout: Token temizlendi, yönlendiriliyor...');
                // Sunucu tarafında da session temizlensin ve ana sayfaya dön
                window.location.href = '/login';
            }
        };
    </script>
    <script src="js/auth-helper.js"></script>
    <script src="js/slider-helper.js"></script>
    <script src="js/dropdown.js"></script>
    <script>
        window.setupHorizontalScroll = function(element) {
            if (!element) return;
            
            element.addEventListener('wheel', (e) => {
                if (e.deltaY !== 0) {
                    e.preventDefault();
                    element.scrollLeft += e.deltaY;
                }
            }, { passive: false });

            let isDown = false;
            let startX;
            let scrollLeft;

            element.addEventListener('mousedown', (e) => {
                isDown = true;
                startX = e.pageX - element.offsetLeft;
                scrollLeft = element.scrollLeft;
            });
            element.addEventListener('mouseleave', () => { isDown = false; });
            element.addEventListener('mouseup', () => { isDown = false; });
            element.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - element.offsetLeft;
                const walk = (x - startX) * 2;
                element.scrollLeft = scrollLeft - walk;
            });
        };

        // Download image as file
        window.downloadImage = async function(url, filename) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(blobUrl);
            } catch (e) {
                console.error('Download failed:', e);
                window.open(url, '_blank');
            }
        };
    </script>
</body>
</html>
